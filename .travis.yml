language: python

cache:
- pip

python:
- '3.4'
- '3.5'
- '3.6'

services: postgresql

before_install:
- export DJANGO_SETTINGS_MODULE=application.settings
- export PYTHONPATH=$HOME/builds/DataIsTheNewBlack/FeedCrunch.IO
- virtualenv venv

install:
- pip install --upgrade pip
- pip install -r requirements.txt

before_script:
- psql -c "CREATE DATABASE travisci;" -U postgres

script:
- python manage.py collectstatic --noinput
- python manage.py makemigrations feedcrunch
- python manage.py migrate
- python manage.py createcachetable
- coverage run manage.py test

addons:
    code_climate:
        repo_token: "$CODE_CLIMATE_REPO_TOKEN"

notifications:
  slack:
    rooms:
      secure: "qu653B/BOfdY3BZ6IXFa1lQxkQMubFtnoMT9mtsrNOlgF1dFI0LlUBqapqApsiitvYU257LFJqdzbp7YyS8gFSgAdtY4wDRsPg9Atl9wwfGXqGFTrbpKJBiTULKgRWqWCwTFAQRO79tqB5VMf93pu5dzD1gK9qJpD7nLahob7hb2F+gW+vbDHsn9sjz5KautpGr5JN5EGzo46ghthqS2oL4tCKQWN0+JT1sEoaU0/31bvrD1HelKO8xLMzR+6eZ1rg950Qgg1qk3SWHi2HwzGcp34GG3TRLKEXCGpNHLJXumqWuneuPjEL0kYqJkLSyIwL49eND5T+l99IX4cdJlgLJsJcLNV+LxXurkxbW+z3R2AsJBgdZA/58dSjhghze8Fgp2FBVnoLPjR0jDKX7T4C84EbY3gRaYTCvAaEeQHgmkRD8GbsYPV81jIQrG8RARadlPPSW5dtVxz/LvkOUtccG7hQ8agWvuHc79iYwX1ahsJIQ7/xETSYmGQw4nAXbUFtsDm2h5OBJzphUxvp10xUP/prAg7mVW4NwQUAurHBBCCvW1LhDDbP2ZKtcEz4OqnN4hFSlwv0aPFi0wEQqGWPaZua8TgO2DzHdke4ECjt8pr7TsqA92O+E2iV4zApgjS6kuY3R8vxAgvPRNDW5GeR/0JKNd1ZtskPTTK+c9iPM="


deploy:

########################### PRODUCTION DEPLOYMENT ###########################
- provider: cloudfoundry
  api: https://api.eu-gb.bluemix.net
  username: jonathan.dekhtiar@utc.fr
  password:
    secure: "RUIftR8a0PqRGK9xw1pcOLh0YMX3O8BmBEJJj4p/tXat5R7GB092PfMJuYWov8uUAWqT0YF5L0UwFMkqOWy9BWq/ThgcEye89unBJhYJscdRJXoN43lLAtOB8/G4jkeFEBQPU4NIxVNjlJiHwhiL+KiXOt7hGjS8oA+XBX405x8gJa9B0n+TcDkd8rVLU9DW4kRkSOXDDX2qtirRFCAwnZW9y1CBCQLF4Turs1iL7s7Ldyj0U688ZH9QhNBoSjpeJcdeY3iusR7kxiqHa3tXS82tWxWWOcfbZaZ0a3ndSqACOwsnopyU0DhP8qwKwD0RmrVHmBVjZFCAx6tncQF7cvCric3ugDdh7GADCW9imlFs41zWizBVuHG5hXFVhZA9Q6s+Mp2NXYceuEEmIIzdBeuHtK90k9JKh2rmylcKzWLC10Sm7F/W1rYD4ekdB6BgWFtjSA2HGuQMVxWVvUmkujR2yW3D4LozRdkWfR5Cphy8ie2GbAnP+5DelkQbefK2TSR95v1/OWcgmyVCR0RVrp36fpxOibJ+tWmKi74lvXgTm8ZsXulasgsl/bJ0/16Fe0lTKsfgtGn3Mojzaet5iSLKo7N8ICrIfCcCV0ytssLhkz+0Tuqw39f/BqNCB+4r7y9DBVzOk3Urid5RjBml5eAD32s/eK0nstLm9lNt2gA="
  organization: FeedCrunch
  space: prod
  manifest: manifest.yml       # (optional)  Defaults to manifest.yml.
  region: eu-gb                # (optional)  [ng, eu-gb , au-syd] Defaults to US South region (ng).
  on:
    branch: Python-3_-_Dev
    python: '3.6'
    repo: DataIsTheNewBlack/FeedCrunch.IO


########################### DEVELOPMENT DEPLOYMENT ###########################
- provider: cloudfoundry
  api: https://api.eu-gb.bluemix.net
  username: jonathan.dekhtiar@utc.fr
  password:
    secure: "RUIftR8a0PqRGK9xw1pcOLh0YMX3O8BmBEJJj4p/tXat5R7GB092PfMJuYWov8uUAWqT0YF5L0UwFMkqOWy9BWq/ThgcEye89unBJhYJscdRJXoN43lLAtOB8/G4jkeFEBQPU4NIxVNjlJiHwhiL+KiXOt7hGjS8oA+XBX405x8gJa9B0n+TcDkd8rVLU9DW4kRkSOXDDX2qtirRFCAwnZW9y1CBCQLF4Turs1iL7s7Ldyj0U688ZH9QhNBoSjpeJcdeY3iusR7kxiqHa3tXS82tWxWWOcfbZaZ0a3ndSqACOwsnopyU0DhP8qwKwD0RmrVHmBVjZFCAx6tncQF7cvCric3ugDdh7GADCW9imlFs41zWizBVuHG5hXFVhZA9Q6s+Mp2NXYceuEEmIIzdBeuHtK90k9JKh2rmylcKzWLC10Sm7F/W1rYD4ekdB6BgWFtjSA2HGuQMVxWVvUmkujR2yW3D4LozRdkWfR5Cphy8ie2GbAnP+5DelkQbefK2TSR95v1/OWcgmyVCR0RVrp36fpxOibJ+tWmKi74lvXgTm8ZsXulasgsl/bJ0/16Fe0lTKsfgtGn3Mojzaet5iSLKo7N8ICrIfCcCV0ytssLhkz+0Tuqw39f/BqNCB+4r7y9DBVzOk3Urid5RjBml5eAD32s/eK0nstLm9lNt2gA="
  organization: FeedCrunch
  space: prod
  manifest: manifest.yml       # (optional)  Defaults to manifest.yml.
  region: eu-gb                # (optional)  [ng, eu-gb , au-syd] Defaults to US South region (ng).
  on:
    branch: Python-3_-_Dev
    python: '3.6'
    repo: DataIsTheNewBlack/FeedCrunch.IO
